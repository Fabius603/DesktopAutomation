<mah:MetroWindow x:Class="DesktopAutomationApp.Views.AddJobStepDialog"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
                 xmlns:sys="clr-namespace:System;assembly=System.Runtime"
                 WindowStartupLocation="CenterOwner"
                 SizeToContent="WidthAndHeight"
                 Title="{Binding DialogTitle}" MinHeight="260" MinWidth="420"
                 ResizeMode="CanResize" ShowInTaskbar="False">

    <mah:MetroWindow.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </mah:MetroWindow.Resources>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Typauswahl -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
            <TextBlock Text="Typ:" VerticalAlignment="Center" Margin="0,0,8,0"/>
            <ComboBox Width="180" ItemsSource="{Binding StepTypes}" SelectedItem="{Binding SelectedType}"/>
        </StackPanel>

        <!-- Dynamische Felder -->
        <StackPanel Grid.Row="1" Margin="0,0,0,8">

            <!-- Template Matching -->
            <StackPanel Visibility="{Binding ShowTemplateMatching, Converter={StaticResource BoolToVis}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Template-Pfad:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Width="220" Text="{Binding TemplateMatchingStep_TemplatePath, UpdateSourceTrigger=PropertyChanged}"/>
                    <Button Content="…" Width="28" Height="24" Margin="8,0,0,0"
                            Command="{Binding BrowseTemplatePathCommand}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="Match Mode:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox Width="200"
                              ItemsSource="{Binding TemplateMatchModesAll}"
                              SelectedItem="{Binding TemplateMatchingStep_TemplateMatchMode}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="Confidence (0..1):" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Width="80" Text="{Binding TemplateMatchingStep_ConfidenceThreshold, UpdateSourceTrigger=PropertyChanged, StringFormat=F2}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <CheckBox Content="ROI aktivieren" IsChecked="{Binding TemplateMatchingStep_EnableROI}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="ROI:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBlock Text="X:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <TextBox Width="60" Text="{Binding TemplateMatchingStep_RoiX}"/>
                    <TextBlock Text="Y:" VerticalAlignment="Center" Margin="8,0,4,0"/>
                    <TextBox Width="60" Text="{Binding TemplateMatchingStep_RoiY}"/>
                    <TextBlock Text="Breite:" VerticalAlignment="Center" Margin="8,0,4,0"/>
                    <TextBox Width="60" Text="{Binding TemplateMatchingStep_RoiW}"/>
                    <TextBlock Text="Höhe:" VerticalAlignment="Center" Margin="8,0,4,0"/>
                    <TextBox Width="60" Text="{Binding TemplateMatchingStep_RoiH}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <CheckBox Content="Ergebnisse zeichnen" IsChecked="{Binding TemplateMatchingStep_DrawResults}"/>
                </StackPanel>
            </StackPanel>

            <!-- Desktop Duplication -->
            <StackPanel Visibility="{Binding ShowDesktopDuplication, Converter={StaticResource BoolToVis}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Desktop Index:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Width="80" IsReadOnly="True" Text="{Binding DesktopDuplicationStep_DesktopIdx}"/>
                    <Button Content="Choose Monitor" Margin="8,0,0,0" Padding="8,4" 
                            Command="{Binding ChooseMonitorCommand}"/>
                </StackPanel>
            </StackPanel>

            <!-- Process Duplication --><!--
            <StackPanel Visibility="{Binding ShowProcessDuplication, Converter={StaticResource BoolToVis}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Prozessname:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Width="220" Text="{Binding ProcessName, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
            </StackPanel>-->

            <!-- Show Image -->
            <StackPanel Visibility="{Binding ShowShowImage, Converter={StaticResource BoolToVis}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Fenstername:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Width="220" Text="{Binding ShowImageStep_WindowName, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="Bildquelle:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <RadioButton Content="Rohbild anzeigen" IsChecked="{Binding ShowImageStep_ShowRawImage}" 
                                 GroupName="ShowImageSource" Margin="16,0,0,0"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <RadioButton Content="Verarbeitetes Bild anzeigen" IsChecked="{Binding ShowImageStep_ShowProcessedImage}" 
                                 GroupName="ShowImageSource" Margin="16,0,0,0"/>
                </StackPanel>
            </StackPanel>

            <!-- Video Creation -->
            <StackPanel Visibility="{Binding ShowVideoCreation, Converter={StaticResource BoolToVis}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Speicherpfad:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Width="220" Text="{Binding VideoCreationStep_SavePath}" IsReadOnly="True"/>
                    <Button Content="…" Width="28" Height="24" Margin="8,0,0,0"
                            Command="{Binding BrowseVideoSavePathCommand}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="Dateiname:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Width="220" Text="{Binding VideoCreationStep_FileName, UpdateSourceTrigger=PropertyChanged}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="Bildquelle:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <RadioButton Content="Rohbild verwenden" IsChecked="{Binding VideoCreationStep_UseRawImage}" 
                                 GroupName="VideoImageSource" Margin="16,0,0,0"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <RadioButton Content="Verarbeitetes Bild verwenden" IsChecked="{Binding VideoCreationStep_UseProcessedImage}" 
                                 GroupName="VideoImageSource" Margin="16,0,0,0"/>
                </StackPanel>
            </StackPanel>

            <!-- Makro Execution -->
            <StackPanel Visibility="{Binding ShowMakroExecution, Converter={StaticResource BoolToVis}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Makro-Name:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox Width="200"
                          ItemsSource="{Binding MakroNames}"
                          SelectedItem="{Binding MakroExecutionStep_SelectedMakroName}"/>
                </StackPanel>
            </StackPanel>

            <!-- Job Execution -->
            <StackPanel Visibility="{Binding ShowJobExecution, Converter={StaticResource BoolToVis}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Job-Name:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox Width="200"
                          ItemsSource="{Binding AvailableJobNames}"
                          SelectedItem="{Binding JobExecutionStep_SelectedJobName}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <CheckBox Content="Auf Beendigung warten" IsChecked="{Binding JobExecutionStep_WaitForCompletion}"/>
                </StackPanel>
            </StackPanel>

            <StackPanel Visibility="{Binding ShowScriptExecution, Converter={StaticResource BoolToVis}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Script-Pfad:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Width="220" Text="{Binding ScriptExecutionStep_ScriptPath, UpdateSourceTrigger=PropertyChanged}"/>
                    <Button Content="…" Width="28" Height="24" Margin="8,0,0,0"
                            Command="{Binding BrowseScriptPathCommand}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <CheckBox Content="Fire and Forget" IsChecked="{Binding ScriptExecutionStep_FireAndForget}"/>
                </StackPanel>
            </StackPanel>

            <!-- KlickOnPoint -->
            <StackPanel Visibility="{Binding ShowKlickOnPoint, Converter={StaticResource BoolToVis}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Doppelklick:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <CheckBox IsChecked="{Binding KlickOnPointStep_DoubleClick}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="Klick-Typ:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox Width="120" SelectedItem="{Binding KlickOnPointStep_ClickType}">
                        <ComboBox.Items>
                            <sys:String>left</sys:String>
                            <sys:String>right</sys:String>
                            <sys:String>middle</sys:String>
                            <sys:String>none</sys:String>
                        </ComboBox.Items>
                    </ComboBox>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="Timeout (ms):" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Width="80" Text="{Binding KlickOnPointStep_TimeoutMs}"/>
                </StackPanel>
            </StackPanel>

            <!-- KlickOnPoint3D -->
            <StackPanel Visibility="{Binding ShowKlickOnPoint3D, Converter={StaticResource BoolToVis}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="FOV:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Width="80" Text="{Binding KlickOnPoint3DStep_FOV, UpdateSourceTrigger=PropertyChanged, StringFormat=F1}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="Maus Sensitivity X:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Width="80" Text="{Binding KlickOnPoint3DStep_MausSensitivityX, UpdateSourceTrigger=PropertyChanged, StringFormat=F2}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="Maus Sensitivity Y:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Width="80" Text="{Binding KlickOnPoint3DStep_MausSensitivityY, UpdateSourceTrigger=PropertyChanged, StringFormat=F2}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="Doppelklick:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <CheckBox IsChecked="{Binding KlickOnPoint3DStep_DoubleClick}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="Klick-Typ:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox Width="120" SelectedItem="{Binding KlickOnPoint3DStep_ClickType}">
                        <ComboBox.Items>
                            <sys:String>left</sys:String>
                            <sys:String>right</sys:String>
                            <sys:String>middle</sys:String>
                            <sys:String>none</sys:String>
                        </ComboBox.Items>
                    </ComboBox>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="Timeout (ms):" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Width="80" Text="{Binding KlickOnPoint3DStep_Timeout}"/>
                </StackPanel>
            </StackPanel>

            <!-- YOLO Detection -->
            <StackPanel Visibility="{Binding ShowYoloDetection, Converter={StaticResource BoolToVis}}">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Model:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox Width="220" 
                              ItemsSource="{Binding YoloDetectionStep_AvailableModels}"
                              SelectedItem="{Binding YoloDetectionStep_Model}"
                              IsEditable="True"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="Klassenname:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox Width="220" 
                              ItemsSource="{Binding YoloDetectionStep_AvailableClasses}"
                              SelectedItem="{Binding YoloDetectionStep_ClassName}"
                              IsEditable="True"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="Confidence (0..1):" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Width="80" Text="{Binding YoloDetectionStep_ConfidenceThreshold, UpdateSourceTrigger=PropertyChanged, StringFormat=F2}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <CheckBox Content="Ergebnisse zeichnen" IsChecked="{Binding YoloDetectionStep_DrawResults}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <CheckBox Content="ROI aktivieren" IsChecked="{Binding YoloDetectionStep_EnableROI}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                    <TextBlock Text="ROI:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBlock Text="X:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                    <TextBox Width="60" Text="{Binding YoloDetectionStep_RoiX}"/>
                    <TextBlock Text="Y:" VerticalAlignment="Center" Margin="8,0,4,0"/>
                    <TextBox Width="60" Text="{Binding YoloDetectionStep_RoiY}"/>
                    <TextBlock Text="Breite:" VerticalAlignment="Center" Margin="8,0,4,0"/>
                    <TextBox Width="60" Text="{Binding YoloDetectionStep_RoiW}"/>
                    <TextBlock Text="Höhe:" VerticalAlignment="Center" Margin="8,0,4,0"/>
                    <TextBox Width="60" Text="{Binding YoloDetectionStep_RoiH}"/>
                </StackPanel>
            </StackPanel>

        </StackPanel>

        <!-- Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Abbrechen" IsCancel="True" Margin="0,0,8,0" Click="Cancel_Click"/>
            <Button Content="{Binding ConfirmButtonText}" IsDefault="True" Command="{Binding ConfirmCommand}"/>
        </StackPanel>
    </Grid>
</mah:MetroWindow>
